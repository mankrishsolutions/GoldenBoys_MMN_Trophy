<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Team Details ‚Äì MMN Golden Boys</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#005BEA">
	<!-- Header Styles -->
	<style>
	.header-banner-img {
		width: 100%;
		overflow: hidden;
		border-radius: 18px 18px 0 0;
		height: 160px;                 /* fixed container */
	}

	.header-banner-img img {
		width: 100%;
		height: 100%;
		object-fit: cover;             /* smart crop */
		object-position: center top;   /* IMPORTANT */
		display: block;
	}

	/* Mobile */
	@media (max-width: 576px) {
		.header-banner-img {
			height: 110px;
		}
	}
	</style>
	
    <style>
        body {
            background: #f4f6f9;
            font-family: "Segoe UI", sans-serif;
            padding: 20px;
        }

        .main-card {
            max-width: 1100px;
            margin: auto;
            border-radius: 18px;
            box-shadow: 0 12px 35px rgba(0,0,0,0.15);
            overflow: hidden;
            background: white;
        }

        .header-banner {
            background: linear-gradient(90deg, #005BEA, #00C6FB);
            padding: 22px 15px;
            text-align: center;
            color: white;
        }

        .header-logo {
            width: 100px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.4);
            margin-bottom: 8px;
        }

        .info-row span {
            margin-right: 25px;
            font-weight: 500;
        }
    </style>
</head>
<body>

<div class="main-card">

	<!-- HEADER BANNER -->
	<div class="header-banner-img">
		<img src="banner.jpeg" alt="MMN Golden Boys Champions Trophy">
	</div>


    <!-- BODY -->
    <div class="card-body p-4">

        <!-- TOP BAR -->
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h4 class="fw-bold mb-0" id="teamTitle"></h4>

            <button class="btn btn-outline-secondary btn-sm"
                    onclick="window.location.assign('adminDashboard.html')">
                ‚Üê Back
            </button>
        </div>

        <hr>

        <!-- CAPTAIN + PAYMENT (ONE LINE) -->
        <div class="info-row mb-3">
            <span id="captainBox"></span>
            <span id="paymentBox"></span>
        </div>

        <h5 class="mt-4 mb-3">Players</h5>

        <!-- PLAYERS TABLE -->
        <div class="table-responsive">
            <table class="table table-bordered align-middle">
                <thead class="table-dark">
                <tr>
                    <th>#</th>
                    <th>Player</th>
                    <th>Age</th>
                    <th>Mobile</th>
                    <th>Aadhaar</th>
                    <th>Aadhaar Image</th>
                    <th>Player Photo</th>
                </tr>
                </thead>
                <tbody id="playersTable"></tbody>
            </table>
        </div>

        <button id="pdfBtn" class="btn btn-success mt-3">
            Download Team PDF
        </button>
    </div>
</div>

<script>
const apiURL = "https://script.google.com/macros/s/AKfycbwE-fiDQn2TzNlDSNLi4m42J6f9lZQcoJZ20Kc8fDKJd3ejt8MPhozOXqn3_YRHJ9Ovdw/exec";
const team = new URLSearchParams(window.location.search).get("team");

document.getElementById("teamTitle").innerText = team;

async function loadTeam() {

    // TEAM DETAILS
    const d = await (await fetch(apiURL + "?action=getTeamDetails&team=" + encodeURIComponent(team))).json();

    document.getElementById("captainBox").innerHTML =
        `Captain: ${d.captainName} (${d.captainMobile})`;

    document.getElementById("paymentBox").innerHTML =
        `Payment: ${d.paymentStatus} | ‚Çπ${d.paymentAmount}`;

    // PLAYERS
    const players = await (await fetch(apiURL + "?action=getTeamPlayers&team=" + encodeURIComponent(team))).json();

    const tbody = document.getElementById("playersTable");
    tbody.innerHTML = "";

    players.forEach((p, i) => {
        tbody.innerHTML += `
        <tr>
            <td>${i + 1}</td>
            <td>${p.playerName}</td>
            <td>${p.age}</td>
            <td>${p.mobile}</td>
            <td>${p.aadhaar}</td>

            <td class="text-center">
                ${p.aadhaarImage
                    ? `<a href="${p.aadhaarImage}" target="_blank" class="btn btn-sm btn-outline-primary">View</a>`
                    : "-"}
            </td>
            <td class="text-center">
                ${p.playerImage
                    ? `<a href="${p.playerImage}" target="_blank" class="btn btn-sm btn-outline-success">View</a>`
                    : "-"}
            </td>
        </tr>`;
    });
}

loadTeam();

document.getElementById("pdfBtn").onclick = async () => {
    const j = await (await fetch(apiURL + "?action=generateTeamPdf&team=" + encodeURIComponent(team))).json();
    window.open(j.pdfUrl, "_blank");
};
</script>

<!-- Service Worker (Auto Update Enabled) -->
<script>
if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
        navigator.serviceWorker.register("service-worker.js")
            .then(registration => {

                // üîÑ Check for updates on every load
                registration.update();

                // üëÇ Listen for new service worker
                registration.addEventListener("updatefound", () => {
                    const newWorker = registration.installing;

                    if (newWorker) {
                        newWorker.addEventListener("statechange", () => {
                            if (
                                newWorker.state === "installed" &&
                                navigator.serviceWorker.controller
                            ) {
                                // üöÄ New version available ‚Üí reload
                                console.log("üîÑ New version available. Reloading...");
                                window.location.reload();
                            }
                        });
                    }
                });
            })
            .catch(err => {
                console.error("Service Worker registration failed:", err);
            });
    });
}
	
self.addEventListener("install", event => {
self.skipWaiting();
});

self.addEventListener("activate", event => {
    event.waitUntil(
        caches.keys().then(keys =>
            Promise.all(
                keys.map(key => caches.delete(key))
            )
        )
    );
    self.clients.claim();
});
</script>
<script src="app.js?v=20251213"></script>
</body>
</html>
